<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="CHICO">
<meta property="og:url" content="http://cicoc.ink/index.html">
<meta property="og:site_name" content="CHICO">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CHICO">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://cicoc.ink/"/>





  <title>CHICO</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CHICO</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://cicoc.ink/2018/08/30/WebView从熟悉到放弃/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Guo Quan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHICO">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/30/WebView从熟悉到放弃/" itemprop="url">WebView从熟悉到放弃</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-30T09:45:44+08:00">
                2018-08-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><blockquote>
<p>现在Android应用native和H5结合的越来越紧密。最近也一直在处理Android原生页面和H5交互的问题，发现好多以前都没有注意过的细节，统一整理下，希望对自己，对大家有所帮助。</p>
</blockquote>
<h4 id="WebSettings设置"><a href="#WebSettings设置" class="headerlink" title="WebSettings设置"></a>WebSettings设置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">//设置是否支持缩放，我这里为false，默认为true。</span><br><span class="line">mWebView.getSettings().setSupportZoom(false);</span><br><span class="line"></span><br><span class="line">//设置是否显示缩放工具，默认为false</span><br><span class="line">mWebView.getSettings().setBuiltInZoomControls(false);</span><br><span class="line"></span><br><span class="line">//设置默认的字体大小，默认为16，有效值区间在1-72之间</span><br><span class="line">mWebView.getSettings().setDefaultFontSize(18);</span><br><span class="line"></span><br><span class="line">//首先阻塞图片，让图片不显示</span><br><span class="line">mWebSettings.setBlockNetworkImage(true);</span><br><span class="line"></span><br><span class="line">//页面加载好以后，在放开图片</span><br><span class="line">mWebSettings.setBlockNetworkImage(false);</span><br><span class="line"></span><br><span class="line">//设置自适应屏幕</span><br><span class="line">webSettings.setUseWideViewPort(true); </span><br><span class="line">// 缩放至屏幕的大小</span><br><span class="line">webSettings.setLoadWithOverviewMode(true); </span><br><span class="line"></span><br><span class="line">//支持插件</span><br><span class="line">webSettings.setPluginsEnabled(true); </span><br><span class="line"></span><br><span class="line">//提高渲染等级</span><br><span class="line">mWebSettings.setRenderPriority(WebSettings.RenderPriority.HIGH);</span><br><span class="line"></span><br><span class="line">//禁止webview上面控件获取焦点(黄色边框)</span><br><span class="line">mWebSettings.setNeedInitialFocus(false);</span><br><span class="line"></span><br><span class="line">//关闭webview中缓存 </span><br><span class="line">webSettings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK); </span><br><span class="line"></span><br><span class="line">//设置可以访问文件 </span><br><span class="line">webSettings.setAllowFileAccess(true); </span><br><span class="line"></span><br><span class="line">//支持通过JS打开新窗口 </span><br><span class="line">webSettings.setJavaScriptCanOpenWindowsAutomatically(true);</span><br><span class="line"></span><br><span class="line">//支持自动加载图片 </span><br><span class="line">webSettings.setLoadsImagesAutomatically(true); </span><br><span class="line"></span><br><span class="line">//设置编码格式</span><br><span class="line">webSettings.setDefaultTextEncodingName(&quot;utf-8&quot;);</span><br></pre></td></tr></table></figure>
<h4 id="webview加载方式"><a href="#webview加载方式" class="headerlink" title="webview加载方式"></a>webview加载方式</h4><p>加载asset中html文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webview.loadUrl(&quot;file:///android_asset/index.html&quot;);</span><br></pre></td></tr></table></figure></p>
<p>加载网络url<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webview.loadUrl(&quot;http://www.baidu.com&quot;);</span><br></pre></td></tr></table></figure></p>
<p>加载手机本地html文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webView.loadUrl(&quot;content://com.android.htmlfileprovider/sdcard/test.html&quot;);</span><br></pre></td></tr></table></figure></p>
<p>加载带参数的post接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String postDate = &quot;name=zhangsan&amp;age=18&amp;sex=1&quot;;</span><br><span class="line">webView.postUrl(&quot;www.test.com&quot;,EncodingUtils.getBytes(postDate,&quot;BASE64&quot;));</span><br></pre></td></tr></table></figure></p>
<p>加载html字符串<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//不支持#、%、\、? 四种字符</span><br><span class="line">webView.loadData(URLEncoder.encode(data, encoding),&quot;text/html&quot;, &quot;utf-8&quot;);  </span><br><span class="line"></span><br><span class="line">webView.loadDataWithBaseURL(&quot;about:blank&quot;, html, &quot;text/html&quot;, &quot;utf-8&quot;, null);</span><br></pre></td></tr></table></figure></p>
<h4 id="Back键控制网页后退"><a href="#Back键控制网页后退" class="headerlink" title="Back键控制网页后退"></a>Back键控制网页后退</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public boolean onKeyDown(int keyCode, KeyEvent event) &#123;</span><br><span class="line">  if ((keyCode == KEYCODE_BACK) &amp;&amp; mWebView.canGoBack()) &#123; </span><br><span class="line">      mWebView.goBack();</span><br><span class="line">      return true;</span><br><span class="line">  &#125;</span><br><span class="line">  return super.onKeyDown(keyCode, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="是否调用外部浏览器"><a href="#是否调用外部浏览器" class="headerlink" title="是否调用外部浏览器"></a>是否调用外部浏览器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">webview.setWebViewClient(new WebViewClient() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean shouldOverrideUrlLoading(WebView view, String url) &#123;</span><br><span class="line">        view.loadUrl(url);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当设置WebViewClient时，不会跳转到外部浏览器，否则会跳转到外部浏览器</p>
<h4 id="Webview内存泄漏问题"><a href="#Webview内存泄漏问题" class="headerlink" title="Webview内存泄漏问题"></a>Webview内存泄漏问题</h4><p>通常我们声明一个webview是使用xml布局实现的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;WebView</span><br><span class="line">    android:id=&quot;@+id/webview&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;／&gt;</span><br></pre></td></tr></table></figure>
<p>然而使用这种方式,加载webview的Activity得不到销毁，即使使用以下代码也没用任何效果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onDestroy() &#123;</span><br><span class="line">    super.onDestroy();</span><br><span class="line">    webview.destroy();</span><br><span class="line">    webview=null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了验证加载webview的Activity一直被持有，可以通过Android Studio来查看<br>点击Android Monitor,然后选择Monitors，点击下图圆圈部分<br><img src="http://note.youdao.com/yws/api/personal/file/WEB517019f745d9fc57823d4788fe563e36?method=download&amp;shareKey=576eeea521149a19169b418ed87e5df1" alt="image"><br>然后会生成一个.hprof文件，进入到Activity目录下面<br><img src="http://note.youdao.com/yws/api/personal/file/WEB3411366a6453db3db9250239e46fe3cb?method=download&amp;shareKey=9bd245153534ab0a9d43580d7ff8d230" alt="image"><br>你会发现没进入一次，WenviewActivity的total cout和heap cout会增加一次。</p>
<p>解决使用webview造成的内存泄漏问题，我们通常不使用xml布局文件声明webview，而是动态生成webview。</p>
<p>首先是在xml文件中的webview位置生明一个LinearLayout</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout</span><br><span class="line">    android:id=&quot;@+id/webview&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;／&gt;</span><br></pre></td></tr></table></figure>
<p>然后只onCreate方法动态生明一个webview,把webview添加到LinearLayout中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">webView=new WebView(getApplicationgContext());</span><br><span class="line">linearLayout.addView(webview);</span><br></pre></td></tr></table></figure>
<p>最后中onDestroy()移除LinearLayout所有子试图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> @Override</span><br><span class="line">protected void onDestroy() &#123;</span><br><span class="line">    super.onDestroy();</span><br><span class="line">    webView.removeAllViews()</span><br><span class="line">    webview.destroy();</span><br><span class="line">    webview=null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="javascript互调"><a href="#javascript互调" class="headerlink" title="javascript互调"></a>javascript互调</h4><p>原生与H5互相调用情况之一是javascript互调。</p>
<p>不管是H5调用原生还是原生调用H5，首先我们都需要设置webview支持javascript，所以我们必须加上下面这行代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WebView.getSettings().setJavaScriptEnabled(true);</span><br></pre></td></tr></table></figure></p>
<p>有了javascript支持，你就可以尽情的去相互调用了。</p>
<p>我们通过一个实际示例来分析一下</p>
<p>有这么一个需求，Html页面上长按语音录制按钮调用手机原生语音录制功能，然后对语音进行识别，把识别后的String传递个Html。在这个需求中，就涉及到Html调用原生语音录制以及原生调用Htmljavascript方法将识别后的语音通过字符串传给Html。</p>
<p>首先我们实现长按Html按钮调用本地语音录制，这就是Html调用原生方法了，这里的方法是本地创建的js方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">private class AshJavaScriptInterface&#123;</span><br><span class="line">    public AshJavaScriptInterface(BaseActivity context) &#123;</span><br><span class="line">        super(context);</span><br><span class="line">    &#125;</span><br><span class="line">    @android.webkit.JavascriptInterface</span><br><span class="line">    public void onTouchDown() &#123;</span><br><span class="line">        //TODO 按钮被按下，类似于原生按下操作</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @android.webkit.JavascriptInterface</span><br><span class="line">    public void onTouchUp() &#123;</span><br><span class="line">        //TODO 按钮被松开，类似于原生松开操作</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将创建的Js方法设置到webview中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public AshJavaScriptInterface createJsInterface() &#123;</span><br><span class="line">    return new AshJavaScriptInterface(this);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">webView.addJavascriptInterface(jsExec,GlobalVariable.JS_INTERFACE_OBJ;</span><br></pre></td></tr></table></figure>
<p>然后剩余的工作就是Html前端的工作了，前端监听按钮事件，当按钮被按下时调用onTouchDown方法（比如QBaoJSBridge.onTouchDown()），而客户端就在onTouchDown方法中处理按钮被按下后的操作，当手松开之后，前端调用onTouchUp方法（比如QBaoJSBridge.onTouchUp()），客户端同时在onTouchUp方法中处理手被松开的操作。到这里，按钮长按监听就完成了，这里主要是Html调用原声Js方法。</p>
<p>语音录制之后，客户端需要对录制的语音进行识别，将语音转换成String字符串（我们这里是使用百度语音识别），识别过程是一个异步耗时的操作，当我们完成识别之后需要把字符串传递给Html，那么我们就需要调用Html的js方法了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webView.loadUrl(&quot;javascript:sendMsgByApp(\&quot;&quot; + msg + &quot;\&quot;)&quot;);</span><br></pre></td></tr></table></figure>
<p>sendMsgByApp方法就是前端定义的一个Js方法，做完这一步，这个需求整个流程就结束了，整个过程中实现了Html和原生的js相互调用</p>
<p>除了以上场景，比如Html要获取手机设备号，点击Html按钮弹出对话框等都可以通过调用本地方法实现</p>
<h4 id="html链接处理"><a href="#html链接处理" class="headerlink" title="html链接处理"></a>html链接处理</h4><p>我们常常会遇到点击Html按钮跳转到原生指定的Activity页面或者获取url链接中的参数进行本地接口调用等情况</p>
<p>那么我们就需要对url链接进行处理，通过判断url进行不同需求操作</p>
<p>具体如何实现的呢？</p>
<p>首先要设置webview的WebViewClient，当我们点击html按钮或者链接时会调用shouldOverrideUrlLoading方法，所以我们对点击进行操作时通常也是在shouldOverrideUrlLoading方法中进行处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> webview.setWebViewClient(new WebViewClient()&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request)&#123;</span><br><span class="line">        boolean isHandle = handleProtocol(url);</span><br><span class="line">        if (isHandle)&#123;</span><br><span class="line">	    return true;</span><br><span class="line">	&#125;</span><br><span class="line">        return super.shouldOverrideUrlLoading(view, request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>handleProtocol就是url处理方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">protected boolean handleQianBaoProtocol(String url) &#123;</span><br><span class="line">	Uri uri = Uri.parse(url);</span><br><span class="line">	String scheme = uri.getScheme();</span><br><span class="line">	String host = uri.getHost();</span><br><span class="line">	String path = uri.getPath();</span><br><span class="line">	</span><br><span class="line">	if (&quot;https&quot;.equals(uri.getScheme())</span><br><span class="line">                &amp;&amp; &quot;maliprod.alipay.com&quot;.equals(uri.getHost())</span><br><span class="line">                &amp;&amp; &quot;/w/trade_pay.do&quot;.equals(uri.getPath())) &#123;</span><br><span class="line">        String orderIds = uri.getQueryParameter(&quot;pay_order_id&quot;);</span><br><span class="line">        if (!TextUtils.isEmpty(orderIds)) &#123;</span><br><span class="line">            //提交商品订单</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     if (&quot;newtab&quot;.equals(uri.getScheme())</span><br><span class="line">            &amp;&amp; &quot;goodstuff.qbao.com&quot;.equals(uri.getHost())</span><br><span class="line">            &amp;&amp; &quot;/similar&quot;.equals(uri.getPath())) &#123;</span><br><span class="line">        String pid = uri.getQueryParameter(&quot;pid&quot;);</span><br><span class="line">        FindLikeActivity.startActivity(this, pid);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="webview长按监听"><a href="#webview长按监听" class="headerlink" title="webview长按监听"></a>webview长按监听</h4><p>长按主要是针对图片、链接、电话、email等等，所以监听长按，我们可以进行图片打开、调用手机邮箱、打电话、分享等操作</p>
<p>监听代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">webview.setOnLongClickListener(new View.OnLongClickListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onLongClick(View v) &#123;</span><br><span class="line">        WebView.HitTestResult result = ((WebView) v).getHitTestResult();</span><br><span class="line">        if (null == result) return true;</span><br><span class="line">        int type = result.getType();</span><br><span class="line">        if (type == WebView.HitTestResult.SRC_IMAGE_ANCHOR_TYPE ||</span><br><span class="line">                type == WebView.HitTestResult.IMAGE_TYPE) &#123;</span><br><span class="line">            String imgUrl = result.getExtra();</span><br><span class="line">            if (!TextUtils.isEmpty(imgUrl)) &#123;</span><br><span class="line">                onImgLongClick(imgUrl);</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码主要长按打开图片，其他的具体操作可以通过查看HitTestResult类，里面有不同类型的常量，通过判断type来进行我们具体的操作</p>
<h4 id="设置html加载进度"><a href="#设置html加载进度" class="headerlink" title="设置html加载进度"></a>设置html加载进度</h4><p>加载网络url一般都是耗时操作，而且当网络环境比较差的时候，加载花费的时间可能更长，为了比较好的体验，我们通常会给一个加载进度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class MyWebChrimeClien extends WebChromeClient &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onProgressChanged(WebView view, int newProgress) &#123;</span><br><span class="line">        if (newProgress == 100) &#123;</span><br><span class="line">            mProgress.setVisibility(View.GONE);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (View.INVISIBLE == mProgress.getVisibility()) &#123;</span><br><span class="line">                mProgress.setVisibility(View.VISIBLE);</span><br><span class="line">            &#125;</span><br><span class="line">            mProgress.setProgress(newProgress);</span><br><span class="line">        &#125;</span><br><span class="line">        super.onProgressChanged(view, newProgress);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mWebView.setWebChromeClient(new MyWebChrimeClien());</span><br></pre></td></tr></table></figure>
<p>主要是通过设置WebChromeClient，通过newProgress的数字判断加载到什么位置，这个进度是包含百分比的，如果不需要知道具体百分比，可以通过设置WebViewClient,<br>重写onPageStarted方法和onPageFinished方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class MyWebViewClient extends WebViewClient &#123;</span><br><span class="line">    public boolean shouldOverrideUrlLoading(WebView view, String url) &#123;</span><br><span class="line">        view.loadUrl(url);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void onPageStarted(WebView view, String url, Bitmap favicon) &#123;</span><br><span class="line">        super.onPageStarted(view, url, favicon);</span><br><span class="line">        mProgress.setVisibility(View.VISIBLE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void onPageFinished(WebView view, String url) &#123;</span><br><span class="line">        super.onPageFinished(view, url);</span><br><span class="line">        mProgress.setVisibility(View.GONE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mWebView.setWebViewClient(new MyWebViewClient());</span><br></pre></td></tr></table></figure>
<p>具体使用哪种方式，那就看你实际需求了，而且进度条也可以根据自己的需求进行自定义</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://cicoc.ink/2018/08/29/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Guo Quan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHICO">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/29/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-29T09:15:15+08:00">
                2018-08-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Chen Guo Quan</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chen Guo Quan</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
